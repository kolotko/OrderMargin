@page "/"
@using Dto
@using Radzen
@using Radzen.Blazor
@using OrderMarginApp.Components.Order
@inject DialogService DialogService

<RadzenSteps CanChange="@CanChange">
    <Steps >
        <RadzenStepsItem Text="Kalkulator cen">
            <PriceCalculatorComponent Prices="_prices" PriceCalculatorReady="@PriceCalculatorReadyEvent"></PriceCalculatorComponent>
        </RadzenStepsItem>
        <RadzenStepsItem Text="Marżowość">
            <OrderFileComponent OrderFileReady="@OrderFileReadyEvent"></OrderFileComponent>
        </RadzenStepsItem>
       
    </Steps>
</RadzenSteps>

@code {
    private List<PriceCalculatorDto>? _prices;
    private List<OrderFileDto>? _orders;
    
    protected override async Task OnInitializedAsync()
    {
        _prices = new();
        await base.OnInitializedAsync();
    }
    
    private void PriceCalculatorReadyEvent(List<PriceCalculatorDto> result)
    {
        _prices = result;
    }
    
    private void OrderFileReadyEvent(List<OrderFileDto> result)
    {
        Console.WriteLine("ess2");
        _orders = result;
    }
    
    private async Task CanChange(StepsCanChangeEventArgs args)
    {
        if (args.SelectedIndex == 0 && _prices!.Count > 0)
        {
            var allRecordValid = _prices!.All(x => string.IsNullOrEmpty(x.ValidatorResult));
            if (allRecordValid)
            {
                return;
            }
        }
        
        await DialogService.Alert(
            "Nie wszystkie rekordy są prawidłowe",
            "Uwaga!",
            new ConfirmOptions()
            {
                CloseDialogOnEsc = false,
                CloseDialogOnOverlayClick = false,
                ShowClose = false,
                OkButtonText = "Ok",
            });
        args.PreventDefault();
    }
}